'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

//import sinon from 'sinon';
//import Bootstrap from 'appium-android-bootstrap';

var _2 = require('../../..');

var _3 = _interopRequireDefault(_2);

//import { SUPPORTED_PERFORMANCE_DATA_TYPES } from '../../../lib/commands/performance.js';//,CPU_KEYS,

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _appiumTestSupport = require('appium-test-support');

var _appiumAdb = require('appium-adb');

var _appiumAdb2 = _interopRequireDefault(_appiumAdb);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var NETWORK_KEYS = [['bucketStart', 'activeTime', 'rxBytes', 'rxPackets', 'txBytes', 'txPackets', 'operations', 'bucketDuration'], ["st", "activeTime", "rb", "rp", "tb", "tp", "op", "bucketDuration"]];
var CPU_KEYS = ["user", "kernel"];
var BATTERY_KEYS = ["power"];
var MEMORY_KEYS = ["totalPrivateDirty", "nativePrivateDirty", "dalvikPrivateDirty", "eglPrivateDirty", "glPrivateDirty", "totalPss", "nativePss", "dalvikPss", "eglPss", "glPss", "nativeHeapAllocatedSize", "nativeHeapSize"];

var SUPPORTED_PERFORMANCE_DATA_TYPES = {
  cpuinfo: 'the amount of cpu by user and kernel process - cpu information for applications on real devices and simulators',
  memoryinfo: 'the amount of memory used by the process - memory information for applications on real devices and simulators',
  batteryinfo: 'the remaining battery power - battery power information for applications on real devices and simulators',
  networkinfo: 'the network statistics - network rx/tx information for applications on real devices and simulators'
};

describe('getperformancedata', function () {
  var adb = new _appiumAdb2['default']();
  var driver = new _3['default']();
  driver.adb = adb;

  describe('performance', (0, _appiumTestSupport.withMocks)({ driver: driver, adb: adb }, function (mocks) {
    it('should get the list of available getPerformance data type', function () {
      var returnValue = _lodash2['default'].keys(SUPPORTED_PERFORMANCE_DATA_TYPES);
      mocks.driver.expects('getPerformanceDataTypes').withExactArgs().returns(returnValue);
      var capability = driver.getPerformanceDataTypes();
      capability.should.eql(_lodash2['default'].keys(SUPPORTED_PERFORMANCE_DATA_TYPES));
    });
    it('should get the amount of cpu by user and kernel process', function () {
      var returnValue = [['user', 'kernel'], [0.9, 1.3]];
      mocks.driver.expects('getPerformanceData').withExactArgs('io.appium.android.apis', 'cpuinfo', 1000).returns(returnValue);
      var cpu = driver.getPerformanceData('io.appium.android.apis', 'cpuinfo', 1000);
      cpu.length.should.be.above(0);
      cpu[0].should.eql(CPU_KEYS);
      if (cpu.length > 1) {
        for (var i = 1; i < cpu.length; ++i) {
          cpu[0].length.should.equal(cpu[i].length);
        }
      }
    });
    it('should get the amount of memory used by the process', function () {
      var returnValue = [['totalPrivateDirty', 'nativePrivateDirty', 'dalvikPrivateDirty', 'eglPrivateDirty', 'glPrivateDirty', 'totalPss', 'nativePss', 'dalvikPss', 'eglPss', 'glPss', 'nativeHeapAllocatedSize', 'nativeHeapSize'], [18360, 8296, 6132, null, null, 42588, 8406, 7024, null, null, 26519, 10344]];
      mocks.driver.expects('getPerformanceData').withExactArgs('io.appium.android.apis', 'memoryinfo', 1000).returns(returnValue);
      var memory = driver.getPerformanceData('io.appium.android.apis', 'memoryinfo', 1000);
      memory.length.should.be.above(0);
      memory[0].should.eql(MEMORY_KEYS);
      if (memory.length > 1) {
        for (var i = 1; i < memory.length; ++i) {
          memory[0].length.should.equal(memory[i].length);
        }
      }
    });
    it('should get the remaining battery power', function () {
      var returnValue = [['power'], [23]];
      mocks.driver.expects('getPerformanceData').withExactArgs('io.appium.android.apis', 'batteryinfo', 1000).returns(returnValue);
      var battery = driver.getPerformanceData('io.appium.android.apis', 'batteryinfo', 1000);
      battery.length.should.be.above(0);
      battery[0].should.eql(BATTERY_KEYS);
      if (battery.length > 1) {
        for (var i = 1; i < battery.length; ++i) {
          battery[0].length.should.equal(battery[i].length);
        }
      }
    });
    it('should get the network statistics', function () {
      var returnValue = [['bucketStart', 'activeTime', 'rxBytes', 'rxPackets', 'txBytes', 'txPackets', 'operations', 'bucketDuration'], [1478091600000, 1099075, 610947, 928, 114362, 769, 0, 3600000], [1478095200000, 1306300, 405997, 509, 46359, 370, 0, 3600000]];
      mocks.driver.expects('getPerformanceData').withExactArgs('io.appium.android.apis', 'networkinfo', 1000).returns(returnValue);
      var network = driver.getPerformanceData('io.appium.android.apis', 'networkinfo', 1000);
      network.length.should.be.above(0);
      var compare = false;

      for (var j = 0; j < NETWORK_KEYS.length; ++j) {
        if (_lodash2['default'].isEqual(NETWORK_KEYS[j], network[0])) {
          compare = true;
        }
      }

      compare.should.equal(true);

      if (network.length > 1) {
        for (var i = 1; i < network.length; ++i) {
          network[0].length.should.equal(network[i].length);
        }
      }
    });
  }));
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9jb21tYW5kcy9wZXJmb3JtYW5jZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O29CQUFpQixNQUFNOzs7OzhCQUNJLGtCQUFrQjs7Ozs7OztpQkFHbkIsVUFBVTs7Ozs7O3NCQUV0QixRQUFROzs7O2lDQUNJLHFCQUFxQjs7eUJBQy9CLFlBQVk7Ozs7QUFFNUIsa0JBQUssTUFBTSxFQUFFLENBQUM7QUFDZCxrQkFBSyxHQUFHLDZCQUFnQixDQUFDOztBQUV6QixJQUFNLFlBQVksR0FBRyxDQUFDLENBQUMsYUFBYSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO0FBQzNNLElBQU0sUUFBUSxHQUFHLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ3BDLElBQU0sWUFBWSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDL0IsSUFBTSxXQUFXLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxvQkFBb0IsRUFBRSxvQkFBb0IsRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLGdCQUFnQixDQUFDLENBQUM7O0FBRWpPLElBQU0sZ0NBQWdDLEdBQUc7QUFDdkMsU0FBTyxFQUFFLGdIQUFnSDtBQUN6SCxZQUFVLEVBQUUsK0dBQStHO0FBQzNILGFBQVcsRUFBRSx5R0FBeUc7QUFDdEgsYUFBVyxFQUFFLG9HQUFvRztDQUNsSCxDQUFDOztBQUVGLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxZQUFNO0FBQ25DLE1BQUksR0FBRyxHQUFHLDRC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QUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUM7QUFDMUMsaUJBQU8sR0FBRyxJQUFJLENBQUM7U0FDaEI7T0FDRjs7QUFFRCxhQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFM0IsVUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtBQUN0QixhQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBQztBQUN0QyxpQkFBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuRDtPQUNGO0tBRUYsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDLENBQUM7Q0FDTCxDQUFDLENBQUMiLCJmaWxlIjoidGVzdC91bml0L2NvbW1hbmRzL3BlcmZvcm1hbmNlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG4vL2ltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG4vL2ltcG9ydCBCb290c3RyYXAgZnJvbSAnYXBwaXVtLWFuZHJvaWQtYm9vdHN0cmFwJztcbmltcG9ydCBBbmRyb2lkRHJpdmVyIGZyb20gJy4uLy4uLy4uJztcbi8vaW1wb3J0IHsgU1VQUE9SVEVEX1BFUkZPUk1BTkNFX0RBVEFfVFlQRVMgfSBmcm9tICcuLi8uLi8uLi9saWIvY29tbWFuZHMvcGVyZm9ybWFuY2UuanMnOy8vLENQVV9LRVlTLFxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHdpdGhNb2NrcyB9IGZyb20gJ2FwcGl1bS10ZXN0LXN1cHBvcnQnO1xuaW1wb3J0IEFEQiBmcm9tICdhcHBpdW0tYWRiJztcblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuY29uc3QgTkVUV09SS19LRVlTID0gW1snYnVja2V0U3RhcnQnLCAnYWN0aXZlVGltZScsICdyeEJ5dGVzJywgJ3J4UGFja2V0cycsICd0eEJ5dGVzJywgJ3R4UGFja2V0cycsICdvcGVyYXRpb25zJywgJ2J1Y2tldER1cmF0aW9uJ10sIFtcInN0XCIsIFwiYWN0aXZlVGltZVwiLCBcInJiXCIsIFwicnBcIiwgXCJ0YlwiLCBcInRwXCIsIFwib3BcIiwgXCJidWNrZXREdXJhdGlvblwiXV07XG5jb25zdCBDUFVfS0VZUyA9IFtcInVzZXJcIiwgXCJrZXJuZWxcIl07XG5jb25zdCBCQVRURVJZX0tFWVMgPSBbXCJwb3dlclwiXTtcbmNvbnN0IE1FTU9SWV9LRVlTID0gW1widG90YWxQcml2YXRlRGlydHlcIiwgXCJuYXRpdmVQcml2YXRlRGlydHlcIiwgXCJkYWx2aWtQcml2YXRlRGlydHlcIiwgXCJlZ2xQcml2YXRlRGlydHlcIiwgXCJnbFByaXZhdGVEaXJ0eVwiLCBcInRvdGFsUHNzXCIsIFwibmF0aXZlUHNzXCIsIFwiZGFsdmlrUHNzXCIsIFwiZWdsUHNzXCIsIFwiZ2xQc3NcIiwgXCJuYXRpdmVIZWFwQWxsb2NhdGVkU2l6ZVwiLCBcIm5hdGl2ZUhlYXBTaXplXCJdO1xuXG5jb25zdCBTVVBQT1JURURfUEVSRk9STUFOQ0VfREFUQV9UWVBFUyA9IHtcbiAgY3B1aW5mbzogJ3RoZSBhbW91bnQgb2YgY3B1IGJ5IHVzZXIgYW5kIGtlcm5lbCBwcm9jZXNzIC0gY3B1IGluZm9ybWF0aW9uIGZvciBhcHBsaWNhdGlvbnMgb24gcmVhbCBkZXZpY2VzIGFuZCBzaW11bGF0b3JzJyxcbiAgbWVtb3J5aW5mbzogJ3RoZSBhbW91bnQgb2YgbWVtb3J5IHVzZWQgYnkgdGhlIHByb2Nlc3MgLSBtZW1vcnkgaW5mb3JtYXRpb24gZm9yIGFwcGxpY2F0aW9ucyBvbiByZWFsIGRldmljZXMgYW5kIHNpbXVsYXRvcnMnLFxuICBiYXR0ZXJ5aW5mbzogJ3RoZSByZW1haW5pbmcgYmF0dGVyeSBwb3dlciAtIGJhdHRlcnkgcG93ZXIgaW5mb3JtYXRpb24gZm9yIGFwcGxpY2F0aW9ucyBvbiByZWFsIGRldmljZXMgYW5kIHNpbXVsYXRvcnMnLFxuICBuZXR3b3JraW5mbzogJ3RoZSBuZXR3b3JrIHN0YXRpc3RpY3MgLSBuZXR3b3JrIHJ4L3R4IGluZm9ybWF0aW9uIGZvciBhcHBsaWNhdGlvbnMgb24gcmVhbCBkZXZpY2VzIGFuZCBzaW11bGF0b3JzJ1xufTtcblxuZGVzY3JpYmUoJ2dldHBlcmZvcm1hbmNlZGF0YScsICgpID0+IHtcbiAgbGV0IGFkYiA9IG5ldyBBREIoKTtcbiAgbGV0IGRyaXZlciA9IG5ldyBBbmRyb2lkRHJpdmVyKCk7XG4gIGRyaXZlci5hZGIgPSBhZGI7XG5cbiAgZGVzY3JpYmUoJ3BlcmZvcm1hbmNlJywgd2l0aE1vY2tzKHtkcml2ZXIsIGFkYn0sIChtb2NrcykgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBnZXRQZXJmb3JtYW5jZSBkYXRhIHR5cGUnLCAoKSA9PiB7XG4gICAgICBsZXQgcmV0dXJuVmFsdWUgPSBfLmtleXMoU1VQUE9SVEVEX1BFUkZPUk1BTkNFX0RBVEFfVFlQRVMpO1xuICAgICAgbW9ja3MuZHJpdmVyLmV4cGVjdHMoJ2dldFBlcmZvcm1hbmNlRGF0YVR5cGVzJykud2l0aEV4YWN0QXJncygpLnJldHVybnMocmV0dXJuVmFsdWUpO1xuICAgICAgbGV0IGNhcGFiaWxpdHkgPSBkcml2ZXIuZ2V0UGVyZm9ybWFuY2VEYXRhVHlwZXMoKTtcbiAgICAgIGNhcGFiaWxpdHkuc2hvdWxkLmVxbChfLmtleXMoU1VQUE9SVEVEX1BFUkZPUk1BTkNFX0RBVEFfVFlQRVMpKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgYW1vdW50IG9mIGNwdSBieSB1c2VyIGFuZCBrZXJuZWwgcHJvY2VzcycsICgpID0+IHtcbiAgICAgIGxldCByZXR1cm5WYWx1ZSA9IFtbJ3VzZXInLCAna2VybmVsJ10sIFswLjksIDEuM11dO1xuICAgICAgbW9ja3MuZHJpdmVyLmV4cGVjdHMoJ2dldFBlcmZvcm1hbmNlRGF0YScpLndpdGhFeGFjdEFyZ3MoJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnLCAnY3B1aW5mbycsIDEwMDApLnJldHVybnMocmV0dXJuVmFsdWUpO1xuICAgICAgbGV0IGNwdSA9IGRyaXZlci5nZXRQZXJmb3JtYW5jZURhdGEoJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnLCAnY3B1aW5mbycsIDEwMDApO1xuICAgICAgY3B1Lmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoMCk7XG4gICAgICBjcHVbMF0uc2hvdWxkLmVxbChDUFVfS0VZUyk7XG4gICAgICBpZiAoY3B1Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBjcHUubGVuZ3RoOyArK2kpe1xuICAgICAgICAgIGNwdVswXS5sZW5ndGguc2hvdWxkLmVxdWFsKGNwdVtpXS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIGFtb3VudCBvZiBtZW1vcnkgdXNlZCBieSB0aGUgcHJvY2VzcycsICgpID0+IHtcbiAgICAgIGxldCByZXR1cm5WYWx1ZSA9IFtbJ3RvdGFsUHJpdmF0ZURpcnR5JywgJ25hdGl2ZVByaXZhdGVEaXJ0eScsICdkYWx2aWtQcml2YXRlRGlydHknLCAnZWdsUHJpdmF0ZURpcnR5JywgJ2dsUHJpdmF0ZURpcnR5JywgJ3RvdGFsUHNzJywgJ25hdGl2ZVBzcycsICdkYWx2aWtQc3MnLCAnZWdsUHNzJywgJ2dsUHNzJywgJ25hdGl2ZUhlYXBBbGxvY2F0ZWRTaXplJywgJ25hdGl2ZUhlYXBTaXplJ10sIFsxODM2MCwgODI5NiwgNjEzMiwgbnVsbCwgbnVsbCwgNDI1ODgsIDg0MDYsIDcwMjQsIG51bGwsIG51bGwsIDI2NTE5LCAxMDM0NF1dO1xuICAgICAgbW9ja3MuZHJpdmVyLmV4cGVjdHMoJ2dldFBlcmZvcm1hbmNlRGF0YScpLndpdGhFeGFjdEFyZ3MoJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnLCAnbWVtb3J5aW5mbycsIDEwMDApLnJldHVybnMocmV0dXJuVmFsdWUpO1xuICAgICAgbGV0IG1lbW9yeSA9IGRyaXZlci5nZXRQZXJmb3JtYW5jZURhdGEoJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnLCAnbWVtb3J5aW5mbycsIDEwMDApO1xuICAgICAgbWVtb3J5Lmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoMCk7XG4gICAgICBtZW1vcnlbMF0uc2hvdWxkLmVxbChNRU1PUllfS0VZUyk7XG4gICAgICBpZiAobWVtb3J5Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBtZW1vcnkubGVuZ3RoOyArK2kpe1xuICAgICAgICAgIG1lbW9yeVswXS5sZW5ndGguc2hvdWxkLmVxdWFsKG1lbW9yeVtpXS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIHJlbWFpbmluZyBiYXR0ZXJ5IHBvd2VyJywgKCkgPT4ge1xuICAgICAgbGV0IHJldHVyblZhbHVlID0gW1sncG93ZXInXSwgWzIzXV07XG4gICAgICBtb2Nrcy5kcml2ZXIuZXhwZWN0cygnZ2V0UGVyZm9ybWFuY2VEYXRhJykud2l0aEV4YWN0QXJncygnaW8uYXBwaXVtLmFuZHJvaWQuYXBpcycsICdiYXR0ZXJ5aW5mbycsIDEwMDApLnJldHVybnMocmV0dXJuVmFsdWUpO1xuICAgICAgbGV0IGJhdHRlcnkgPSBkcml2ZXIuZ2V0UGVyZm9ybWFuY2VEYXRhKCdpby5hcHBpdW0uYW5kcm9pZC5hcGlzJywgJ2JhdHRlcnlpbmZvJywgMTAwMCk7XG4gICAgICBiYXR0ZXJ5Lmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoMCk7XG4gICAgICBiYXR0ZXJ5WzBdLnNob3VsZC5lcWwoQkFUVEVSWV9LRVlTKTtcbiAgICAgIGlmIChiYXR0ZXJ5Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBiYXR0ZXJ5Lmxlbmd0aDsgKytpKXtcbiAgICAgICAgICBiYXR0ZXJ5WzBdLmxlbmd0aC5zaG91bGQuZXF1YWwoYmF0dGVyeVtpXS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICB9ICAgICAgXG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIG5ldHdvcmsgc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIGxldCByZXR1cm5WYWx1ZSA9IFtbJ2J1Y2tldFN0YXJ0JywgJ2FjdGl2ZVRpbWUnLCAncnhCeXRlcycsICdyeFBhY2tldHMnLCAndHhCeXRlcycsICd0eFBhY2tldHMnLCAnb3BlcmF0aW9ucycsICdidWNrZXREdXJhdGlvbiddLCBbMTQ3ODA5MTYwMDAwMCwgMTA5OTA3NSwgNjEwOTQ3LCA5MjgsIDExNDM2MiwgNzY5LCAwLCAzNjAwMDAwXSwgWzE0NzgwOTUyMDAwMDAsIDEzMDYzMDAsIDQwNTk5NywgNTA5LCA0NjM1OSwgMzcwLCAwLCAzNjAwMDAwXV07XG4gICAgICBtb2Nrcy5kcml2ZXIuZXhwZWN0cygnZ2V0UGVyZm9ybWFuY2VEYXRhJykud2l0aEV4YWN0QXJncygnaW8uYXBwaXVtLmFuZHJvaWQuYXBpcycsICduZXR3b3JraW5mbycsIDEwMDApLnJldHVybnMocmV0dXJuVmFsdWUpO1xuICAgICAgbGV0IG5ldHdvcmsgPSBkcml2ZXIuZ2V0UGVyZm9ybWFuY2VEYXRhKCdpby5hcHBpdW0uYW5kcm9pZC5hcGlzJywgJ25ldHdvcmtpbmZvJywgMTAwMCk7XG4gICAgICBuZXR3b3JrLmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoMCk7XG4gICAgICBsZXQgY29tcGFyZSA9IGZhbHNlO1xuXG4gICAgICBmb3IgKCBsZXQgaj0gMCA7IGogPCBORVRXT1JLX0tFWVMubGVuZ3RoIDsgKysgail7XG4gICAgICAgIGlmIChfLmlzRXF1YWwoIE5FVFdPUktfS0VZU1tqXSwgbmV0d29ya1swXSkpe1xuICAgICAgICAgIGNvbXBhcmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbXBhcmUuc2hvdWxkLmVxdWFsKHRydWUpO1xuXG4gICAgICBpZiAobmV0d29yay5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbmV0d29yay5sZW5ndGg7ICsraSl7XG4gICAgICAgICAgbmV0d29ya1swXS5sZW5ndGguc2hvdWxkLmVxdWFsKG5ldHdvcmtbaV0ubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgfSk7XG4gIH0pKTtcbn0pOyJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4ifQ==
